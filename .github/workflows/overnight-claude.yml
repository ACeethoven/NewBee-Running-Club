# .github/workflows/overnight-claude.yml
name: Overnight Claude Work
on:
  schedule:

    - cron: "30 9 * * *"  # 1:30 AM PST (San Francisco winter time)

  workflow_dispatch:  # Allow manual trigger for testing

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  claude-work:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: dev

      - uses: anthropics/claude-code-action@v1
        env:
          ANTHROPIC_MODEL: claude-opus-4-5-20251101
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          base_branch: dev
          claude_args: |
            --model claude-opus-4-5-20251101
            --allowedTools "Edit,Write,Bash,Read,Glob,Grep,Task"
          prompt: |
            IMPORTANT: This project has a React frontend (client/) and Python/FastAPI backend (server/).
            There is NO package.json in the server directory - it uses requirements.txt for Python dependencies.
            Read CLAUDE.md for full project context before starting any work.

            Read the WISHLIST.md file in the repository root.

            For each uncompleted task (marked with `- [ ]`):
            1. Plan the implementation thoroughly
            2. Implement the changes
            3. Create a separate PR for each task targeting the dev branch
            4. Mark the task as completed in WISHLIST.md (change `- [ ]` to `- [x]`)

            Work autonomously without asking for approval. Create clear, well-documented PRs
            so the maintainer can review them in the morning.

            If a task is unclear or too large, break it into smaller sub-tasks and
            implement what you can, noting any questions in the PR description.
